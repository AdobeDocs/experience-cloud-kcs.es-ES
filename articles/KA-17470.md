---
title: "Error: Demasiados archivos abiertos"
description: Descripción
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "10/20/2021 11:05:19 PM"
article-published-by: Roxann McGlumphy
article-published-date: "10/20/2021 11:10:07 PM"
version-number: 1
article-number: KA-17470
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=dc40aa30-fa31-ec11-b6e5-000d3a5ba97a"
exl-id: 534227cf-df15-4255-b699-e26953bf90e6
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '641'
ht-degree: 100%

---

# Error: Demasiados archivos abiertos

## Descripción

<br><br><br>Problema<br><br><br><br><br><br>
Los archivos de registro contienen el error &quot;Demasiados archivos&quot; y AEM no responde.
<br><br><br><br><br><br>Causa<br><br><br><br><br><br>
La causa es una de dos posibilidades:

- La aplicación no está cerrando recursos como archivos o sockets después de usarlos.
- O la aplicación requiere más archivos abiertos de los que permite el proceso.



## Resolución

<br><br> <br><br><br><br><br><br>
La solución a este problema es:

1. Averigüe cuál es la causa de que se haya alcanzado el límite de archivos abiertos
2. Aumente el límite o arregle los fallos de la aplicación.

<br><br><br><br>Encuentre los archivos o sockets que quedan abiertos<br><br> <br><br>
\*\* Tenga en cuenta que los límites de archivos abiertos se aplican al total de archivos, conexiones y sockets abiertos combinados, no solo a los archivos.

En la plataforma [!DNL Linux], el comando `lsof` puede usarse para depurar qué recursos mantiene abiertos el proceso.

Aquí tiene un ejemplo de script para recoger una salida útil de `lsof`:
<br><br><br><br><br> <br><br><br><br>

```
#!/bin/bash` `if` `$` `# -eq 0` `  ` `then` `    ` `echo` `"No PID specified"` `    ` `echo` `"Run command with PID, for example:"` `    ` `echo` `"lsof-script.sh 12345"` `    ` `exit` `2` `fi`<br>   <br>  `JAVA_PROCESS_PID=$1`<br>   <br>  `lsof` `-p $JAVA_PROCESS_PID` `lsof` `-output-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Files open by the process:"` `cat` `lsof` `-output-$JAVA_PROCESS_PID.txt | ` `wc` `-l`<br>   <br>  `echo` `"Generated output file with counts of grouped open files lsof-sorted-counts-$JAVA_PROCESS_PID.txt"` `cat` `lsof` `-output-$JAVA_PROCESS_PID.txt |` `awk` `'{print $9}'` `|` `sed` `-e` `"s/\(.*\)\(segmentstore\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(repository/index\).*$/\1\2/"` `|` `sed` `-e` `"s/\(.*\)\(felix/bundle\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/lib\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/logs\).*$/\1\2/"` `| ` `sed` `-e` `"s/\(.*\)\(/ext\).*$/\1\2/"` `|` `sort` `|` `uniq` `-c |` `sort` `-rn -k1` `lsof` `-sorted-counts-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Total open files in OS:"` `lsof` `|` `wc` `-l` 
```


<br><br><br><br><br> <br><br>
Salida de ejemplo:
<br><br><br><br><br> <br><br><br><br>

```
 $ ./lsof-script.sh 18070 Files open by the process:      1995 Generated output file with counts of grouped open files: lsof-sorted-counts-18070.txt Total open files in OS:     18399 
```

<br><br><br><br><br> <br><br>
Inspeccione la salida del archivo `lsof-sorted-counts-\*.txt` generado.  Muestra qué archivos o sockets mantiene actualmente abiertos el proceso.

Si encuentra en la lista sockets o archivos abiertos que no deberían estarlo, es probable que se deba a un error de la aplicación.  Actualice el código de su aplicación para cerrar los archivos y sockets después de usarlos.

Una causa común de los sockets abiertos persistentes es el código personalizado que hace el servicio web.  En muchos casos, se usan bibliotecas como [!DNL Apache] [!DNL Commons HttpClient] pero las conexiones nunca son cerradas por los desarrolladores.  Consulte [este artículo](https://stackoverflow.com/questions/43454514/proper-usage-of-apache-httpclient-and-when-to-close-it) para obtener detalles sobre [!DNL Apache] [!DNL Commons HttpClient].
<br><br><br><br> <br><br>Aumente el límite de la sesión de shell<br><br><br><br> <br><br>
Compruebe el límite del usuario para el máximo de archivos abiertos y ejecute lo siguiente como el mismo usuario con el que se ejecuta el proceso AEM:

`ulimit -Sn ulimit -Hn`

Cuando use el script de inicio predeterminado de AEM/CQ, haga lo siguiente para aumentar el límite:

1. Abra `crx-quickstart/bin/start` para editarlo
2. Añada la variable `CQ_MAX_OPEN_FILES` en la parte superior del script:  `CQ_MAX_OPEN_FILES=8192 export CQ_MAX_OPEN_FILES`


Si ve el error `-bash: ulimit: open files: cannot modify limit: Operation not permitted` al iniciar AEM, la configuración anterior no funciona.

En su lugar, es necesario aumentar el límite en `/etc/security/limits.conf`. A continuación hay detalles sobre cómo reconfigurar el límite de usuarios.

Si usa un servidor de aplicaciones de terceros como [!DNL JBoss] o [!DNL Websphere], siga las secciones siguientes y verifique con la documentación del proveedor.

Nota:

Si ninguna de las configuraciones de este artículo resuelve el problema, vea qué archivos están abiertos usando el comando `lsof -p`. (`-p` es el ID del proceso problemático). Puede ser que su aplicación esté dejando abiertos los gestores de archivos. Si ve que los controladores los gestiona principalmente AEM y no su aplicación, póngase en contacto con el servicio de asistencia.


<br><br><br><br> <br><br>Aumentar los límites del usuario<br><br><br><br> <br><br>
Para cambiar el número máximo de archivos abiertos para los usuarios no root, cambie el archivo `/etc/security/limits.conf`. Puede establecer el límite por usuario:

`crx_process_username soft nofile 8092`

`crx_process_username hard nofile 20000`

Nota:

Esta configuración no tendrá efecto hasta la próxima vez que el usuario inicie sesión.


<br><br><br><br> <br><br>Aumente el límite del sistema<br><br><br><br> <br><br>
A veces, el límite del usuario es lo bastante alto, pero el propio sistema ha alcanzado su número máximo de archivos. Ejecute lo siguiente como usuario `su/root`:

1. Compruebe la configuración del archivo máximo abierto en el sistema operativo (si está por debajo de 20000, sería lógico aumentar esta configuración): `cat /proc/sys/fs/file-max`
2. Añada esta línea a `/etc/sysctl.conf` para aumentar el valor máximo de archivos abiertos del sistema:  `fs.file-max = 300000`
3. Ejecute este comando:  `sysctl -p`
4. Compruebe que se muestre el nuevo valor cuando ejecute este comando:  `cat /proc/sys/fs/file-max`


Nota:

Esta configuración no tendrá efecto hasta la próxima vez que el usuario inicie sesión.


<br><br><br><br> <br><br>Información adicional<br><br><br><br> <br><br>
Este error se produce cuando el sistema o usuario está gestionando su número máximo de archivos.

DESCARGAR
[Obtener archivo](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/TooManyOpenFiles/jcr:content/main-pars/kb_download/check_open_files.sh "check_open_files.sh") <br><br>Script de shell que puede usar para monitorear el uso de archivos abiertos. Use este script solo si el error &quot;demasiados archivos abiertos&quot; persiste tras aumentar el máximo. También puede usarlo si sospecha que CRX o su aplicación están dejando abiertos los gestores de archivos. Antes de usar el script, configure las siguientes variables: `JAVA_HOME`, `QUICKSTART_PATH`, `OUTPUT_DIR`, `USER`, `MAX_FILES_THRESHOLD`. Para usar el script, configúrelo como un trabajo cron.
