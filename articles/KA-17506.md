---
title: Análisis del protocolo SMPP con [!DNL Wireshark]
description: Descripción
solution: Campaign
product: Campaign
applies-to: Campaign Classic
keywords: KCS, SMPP, Wireshark
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Craig Thonis
article-created-date: 5/6/2022 3:51:03 PM
article-published-by: Craig Thonis
article-published-date: 5/6/2022 3:52:19 PM
version-number: 4
article-number: KA-17506
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=9319e64e-54cd-ec11-a7b5-6045bd00d4f5
exl-id: 39c89da2-36ae-4c66-9553-cfc3d5b4003a
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '2415'
ht-degree: 100%

---

# Análisis del protocolo SMPP con [!DNL Wireshark]

## Descripción

<br>Aprenda a analizar el tráfico SMPP mediante [!DNL Wireshark].<br><br><br><br><br>Introducción<br><br><br><br> <br><br>
La mayoría de los SMS-C de alto rendimiento son compatibles con la versión 3.4 del protocolo SMPP. Este protocolo permite enviar SMS y recibir información sobre su entrega. El protocolo SMPP está documentado en la Especificación del Protocolo SMPP v3.4 disponible en Internet como documento PDF.

Este artículo no sustituye a esta especificación: ofrece consejos prácticos sobre cómo interpretar la especificación del protocolo y hacerla coincidir con la pantalla [!DNL Wireshark] para ayudar a solucionar los problemas entre Adobe Campaign y el socio SMS-C.

Dado que el protocolo SMPP contiene muchas partes diferentes que se dejan a la interpretación del equipo de implementación, existen diferencias entre los distintos SMS-C.

Cuando solucione problemas, póngase siempre en contacto con el socio SMS-C para obtener información o para que le ayude a revisar lo que obtiene. Si el SMS-C responde con un error, su socio SMS-C será la persona más indicada para explicarle el porqué. Si en lugar de conectarse a un SMS-C real está usando un simulador de SMPP, deberá usar el código fuente (o un depurador) para entender lo que ocurre.


## Resolución

<br><br>Capturar el tráfico de red sin [!DNL Wireshark]<br><br><br><br><br><br>
Si no tiene acceso directo a la máquina, puede ser necesario capturar con herramientas de línea de comandos como *tcpdump*. Si ya conoce el puerto TCP de la conexión, ponga el filtro correcto para evitar capturar todo el tráfico. Este es un ejemplo de línea de comandos `tcpdump` para capturar el puerto `12345` a <b>`outfile.pcap`</b>:


| `tcpdump -i any -w outfile.pcap tcp port 12345` |
| --- |


A continuación, se puede abrir el archivo <b>`outfile.pcap`</b> en [!DNL Wireshark] para su posterior análisis.


Manejo de <br><br>[!DNL Wireshark]<br><br><br><br> <br><br><br><br>
Este tema da por hecho que está familiarizado con los fundamentos de [!DNL Wireshark]: captura de paquetes, definición de filtros simples y lectura de detalles de los paquetes. Hay una breve introducción disponible en [howtogeek - Cómo usar [!DNL Wireshark] para capturar, filtrar, e inspeccionar paquetes](https://www.howtogeek.com/104278/how-to-use-wireshark-to-capture-filter-and-inspect-packets/).

Para filtrar el tráfico SMPP en [!DNL Wireshark], hay tres características importantes:

- Use un filtro de visualización en el puerto del SMS-C.
Por ejemplo, si el SMS-C usa el puerto `10000`, utilice el siguiente filtro:
   *`tcp.port == 10000`*


Para aislar los paquetes por número de teléfono o por contenido de texto, use la función de búsqueda con la siguiente configuración:
![smpp1](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image/smpp1.png "smpp1")
- Use la herramienta <b>Seguir flujo TCP</b> para aislar el flujo en el que está trabajando.
Cierre la ventana de texto rojo/azul que aparece porque solo es útil para los protocolos de texto irrelevantes para el SMPP.
   ![smpp2](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_964579199/smpp2.png "smpp2")



<br><br><br><br>Protocolo SMPP<br><br> <br><br>
El protocolo funciona a través de TCP y es totalmente binario, lo que significa que se necesitan herramientas especiales como [!DNL Wireshark] (o un editor hexadecimal) para descifrar el contenido del flujo.

El flujo se compone de PDU independientes: cada PDU es un mensaje que contiene un comando, un estado, un número de secuencia y otra información basada en el comando.

Debido a la naturaleza de TCP como protocolo de flujo, un paquete TCP puede contener más de una PDU, y estas pueden abarcar dos o más paquetes TCP. [!DNL Wireshark] reensamblará las PDU correctamente, por lo que es mayormente transparente para el usuario de [!DNL Wireshark].

Aquí tiene un ejemplo de las PDU que pasan por la red cuando se envía una MT y luego se recibe una SR:
![smpp3](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_388497282/smpp3.png "smpp3")
Nota:

la lista de comandos estándar se encuentra en la sección 5.1.2.1 de la especificación SMPP (Conjunto de comandos SMPP).
<br><br><br><br><br><br>Respuestas SMPP<br><br><br><br> <br><br>
El protocolo SMPP requiere que una PDU de respuesta reconozca todos los comandos:

*`BIND_TRANSMITTER_RESP`* reconoce a `BIND_TRANSMITTER`, *`SUBMIT_SM_RESP`* reconoce a *`SUBMIT_SM`*, etc.

Hay un tiempo de espera para las respuestas que suele ser de 10, 30 o 60 segundos. La respuesta puede contener un acuse de recibo positivo (`command _status = 0`) o un error (véase 5.1.3 *`command_status`*, *tabla 5-2* en la especificación SMPP para la lista de errores estándar). La mayoría de las veces, estas respuestas son inmediatas y no se alcanza un tiempo de espera de respuesta.

Asegúrese de distinguir entre los errores de respuesta SMPP y los códigos de error SR: el mismo código de error puede significar cosas diferentes en el error de respuesta o en el campo de error SR. Cuando se informa de un código de error, hay que tener mucho cuidado con dónde se encuentra porque el significado del valor depende de su contexto.
<br><br><br><br><br><br>Inicialización de la conexión SMPP<br><br><br><br><br><br>
La conexión SMPP comienza conectándose mediante TCP. A continuación, [!DNL Campaign] envía una operación `BIND`, reconocida por una `BIND RESP`. Estas operaciones se describen en la sección 4.1 de la especificación SMPP (operación `BIND`).
![smpp4](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_468626174/smpp4.png "smpp4")
La operación &quot;bind&quot; realiza la comprobación del inicio de sesión/contraseña e intercambia información sobre el nombre de la plataforma, la versión y otros campos descritos en la especificación.

Nota:

El inicio de sesión se puede encontrar en el campo `system_id`.



En [!DNL Campaign], debería ver un paquete *`BIND_TRANSMITTER`* cuando se inicia una transferencia MT y un paquete *`BIND_RECEIVER`* cuando *`nlsm s`* activa una conexión MO/SR.

<b>Emisor, receptor y transceptor: </b>El conector SMPP para Campaign Classic funciona en modo transmisor/receptor por separado: hay dos conexiones TCP, una para transmitir MT y otra para recibir MO y SR. Tenga en cuenta que [!DNL Campaign] siempre inicia la conexión TCP, incluso para el modo receptor.

SMPP también proporciona un modo de transceptor, pero este modo no está implementado en el conector SMPP de Campaign Classic.

El conector SMPP usa múltiples conexiones en paralelo para transmitir la MT. Esto no se puede controlar debido a la forma en que está diseñado el conector.
<br><br><br><br><br><br>Recepción de MO<br><br><br><br><br><br>
Cuando el receptor está vinculado, el SMS-C puede enviar MO en cualquier momento. La MO se envía usando una PDU *`DELIVER_SM`* con los bits 2-5 de *`esm_clas s`* en blanco (a menudo, *`esm_class`* será simplemente 0).
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_695769115/smpp5.png "smpp5")
Una PDU *`DELIVER_SM_RESP`* con el mismo *`sequence_number`* debe responder rápidamente la PDU *`DELIVER_SM`*.
<br><br><br><br><br><br>Envío de la MT<br><br><br><br><br><br>
Para enviar una MT, el transmisor debe estar vinculado con éxito. Antes de nada, compruebe que el proceso de vinculación se haya realizado con éxito.

La MT se envía en una PDU *`SUBMIT_SM`*. El SMS-C debe responder rápidamente con una PDU *`SUBMIT_SM_RESP`*: este paquete de respuesta es especial porque contiene el ID del mensaje en la base de datos del SMS-C (incluya siempre este ID cuando hable con el socio SMS-C para que pueda encontrar el mensaje más rápido). Este ID estará presente en el SR y es la única manera de hacer coincidir el MT con su correspondiente SR.

El campo *`registered_delivery`* (descrito en la sección 5.2.17 de la especificación) le indica al SMS-C si se solicita una SR para esta MT en particular. Si no recibe SR para un mensaje específico, compruebe que el campo esté configurado correctamente en la PDU *`SUBMIT_SM`*.
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1891077095/smpp5.png "smpp5")<br><br><br><br><br><br>Codificación de la MT<br><br><br><br><br><br>
Advertencia:

la codificación de los SMS es un tema complejo con muchas trampas y varias implementaciones.


<br><br><br><br> <br><br>
Una buena práctica es ponerse siempre en contacto con el socio SMS-C en caso de problemas de codificación. Su socio SMS tiene un conocimiento preciso de la codificación admitida y de las reglas especiales que pueden aplicarse debido a las limitaciones de su plataforma técnica. Pídale que compruebe lo que le envía y lo que le devuelve. Es el único camino para una interconexión exitosa y estable.

Los mensajes SMS utilizan una codificación especial de 7 bits, a menudo denominada codificación GSM7. Consulte [!DNL Wikipedia] GSM 03.38 (en inglés).
<br><br><br><br> <br><br>
En el protocolo SMPP, el texto de GSM7 se expandirá a 8 bits por carácter para facilitar la resolución de problemas. El SMS-C lo empaquetará en 7 bits por carácter antes de enviarlo al dispositivo móvil. Esto significa que el campo de mensaje corto del SMS puede tener hasta 160 bytes de longitud en el marco SMPP, mientras que está limitado a 140 bytes cuando se envía en la red móvil (el bit más significativo simplemente se descarta).

En caso de problemas de codificación, hay que comprobar algunos aspectos importantes:

- Primero, asegúrese de saber qué caracteres pertenecen a cada codificación. El GSM7 es tristemente célebre por su compatibilidad parcial con los signos diacríticos (acentos). Especialmente en francés, donde é y è son parte de GSM7, pero ê, â o ï no lo son. La situación mejora en el caso del español.
- La C con cedilla (ç) solo está presente en mayúsculas en el alfabeto GSM7, pero algunos teléfonos la representan en minúsculas o en mayúsculas &quot;inteligentes&quot;: la recomendación general es evitarla por completo y eliminar la cedilla (sigue siendo muy legible en francés) o cambiar a UCS-2.
- No use ASCII en los SMS, a menos que el interlocutor del SMS-C lo solicite de manera explícita: esta codificación desperdicia espacio porque tiene caracteres de 8 bits y menos cobertura que el GSM7.
- Latín-1 no siempre es compatible: compruebe la compatibilidad con su socio de SMS-C antes de intentar usar Latín-1.
- El conector Adobe Campaign Classic no admite tablas de cambio de idioma nacional. Debe usar UCS-2 en su lugar.
- UCS-2 y UTF-16 suelen mezclarse por teléfono. Esto es un problema para las personas que envían emoji y otros caracteres poco utilizados que no están presentes en UCS-2.
- La codificación GSM7 no es compatible con [!DNL Wireshark]: los caracteres especiales se mostrarán incorrectamente. Si necesita comprobar si una cadena GSM7 está bien codificada, debe comparar los códigos hexadecimales con la tabla GSM7.


El campo *`data_coding`* indica qué codificación se utiliza. El único problema es que el valor 0 significa la codificación SMS-C por defecto en la especificación, pero en general significa GSM7. Compruebe con el socio SMS-C a qué codificación está asociada `data_coding = 0` (Adobe Campaign solo admite GSM7 para `data_coding* = 0`).

El tamaño máximo de un mensaje depende de su codificación. Esta tabla resume toda la información relevante:
<br><br><br><br> <br>

| Codificación | data_coding | Tamaño del mensaje (caracteres)  | Tamaño de la parte para SMS de varias partes  | Caracteres disponibles  |
| --- | --- | --- | --- | --- |
| GSM7 | 0 | 160 | 152 | [Conjunto de caracteres básico GSM7 + extensión](https://en.wikipedia.org/wiki/GSM_03.38) (los caracteres extendidos tienen 2 caracteres)  |
| Latin-1  | 3 | 140 | 134 | ISO-8859-1 |
| UCS-2 UTF-16  | 8 | 70 | 67 | Unicode (varía de un teléfono a otro) |

<br><br><br><br><br>Encabezado de datos de usuario (UDH)<br><br><br><br><br><br>
Los UDH (encabezados de datos de usuario) son pequeñas cabeceras binarias que se añaden al texto de un SMS. Pueden activar funciones especiales como la concatenación de SMS, las tablas de cambio de idioma nacional, los logotipos/imágenes (raramente usados) o el envío WAP.

Como el UDH forma parte del campo de texto (campo SMPP short_message), acorta el tamaño efectivo de un SMS. Por ejemplo, un SMS UDH concatenado consumirá 6 bytes por parte del SMS (son 6 bytes reales de 8 bits, no caracteres de 7 bits), lo que solo deja espacio suficiente para 152 caracteres de 7 bits por parte del mensaje.

[!DNL Wikipedia] tiene buenos artículos sobre el encabezado de datos de usuario y el SMS concatenado (en inglés).

Para saber si un short_message contiene un UDH, compruebe los bits 6 y 7 de esm_class (véase la sección 5.2.12 de la especificación). [!DNL Wireshark] analiza el UDH en la interfaz y proporciona información precisa.
![smpp7](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_738682084/smpp7.png "smpp7")
En la captura de pantalla anterior, puede ver el encabezado de datos de usuario en el campo del mensaje (1), la información contenida en el UDH (2) y alguna información extra que no pertenece al paquete pero que se computa por [!DNL Wireshark] (3): el campo del cuerpo del mensaje corto es especialmente interesante ya que contiene el mensaje completo reensamblado por [!DNL Wireshark].
<br><br><br><br><br><br>Recepción de SR<br><br><br><br><br><br>
Cuando el receptor está vinculado, el SMS-C puede enviar SR en cualquier momento. El SR se envía usando una PDU DELIVER_SM con los bits 2-5 del conjunto *`esm_class`*.
![smpp8](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_158644074/smpp8.png "smpp8")
Una PDU *`DELIVER_SM_RESP`* con el mismo *`sequence_number`* debe responder rápidamente la PDU *`DELIVER_SM`*. Para encontrar la MT que coincida con esta SR, busque *`SUBMIT_SM_RESP`* con el mismo ID. Por ejemplo, esta es la MT que coincide con la SR:
![smpp9](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1012110897/smpp9.png "smpp9")
Los SR solo se envían si el campo *`registered_delivery`* está configurado en la MT.

Nota:

El conector SMPP de Adobe Campaign Classic no gestiona los SR que llegan antes del paquete *`SUBMIT_SM_RESP`*. La especificación no prohíbe este comportamiento de forma explícita, pero se considera un mal comportamiento (significaría que el mensaje se ha recibido antes de enviarse). Si se encuentra con este caso muy a menudo, pídale a su socio SMS-C que arregle su plataforma.
<br><br><br><br><br><br>Descifrar el campo short_message de SR<br><br><br><br><br><br>
El campo de texto de las PDU de SR tiene una codificación especial descrita en el Apéndice B de la especificación del protocolo SMPP. Por desgracia, este formato solo es una recomendación que no forma parte del protocolo, aunque la mayoría de los SMS-C respetan más o menos este mismo formato.

Debería pedir directamente al socio SMS-C una documentación de su propia implementación y volver a comprobar si coincide con lo que se ve en [!DNL Wireshark]. La mayoría de las veces, los implementadores de SMS-C ni siquiera conocen su implementación y esto conduce a problemas y malentendidos. No dude en pedir ayuda al socio SMS-C si tiene alguna duda sobre este campo (en especial los códigos de error).

El formato básico es el siguiente:

*`id:IIIIIIIIII sub:SSS dlvrd:DDD submit date:YYMMDDhhmm done date:YYMMDDhhmm stat:DDDDDDD err:EEE`*

*`Text:........`*

Estas son las directrices generales para leer la línea anterior:

- El ID es el mismo que se ha enviado en el *`SUBMIT_SM_RESP`* del MT correspondiente.
- Puede ignorar los problemas en el campo`text`: [!DNL Campaign] lo ignora por porque no es útil ni fiable y puede llegar a ser completamente ilegible si el SMS se envió con una codificación distinta a la ASCII alfanumérica pura. Este es un comportamiento normal.
- Los nombres de los campos no distinguen mayúsculas de minúsculas (por ejemplo, `id`: `sub`: `Text`: puede anotarse también como `ID`: `SUB`: `text`:).
- El campo*`dlvrd`* no suele ser fiable, a no ser que el socio SMS-C lo haya documentado.
- Las fechas pueden tener cualquier zona horaria, lo que las hace prácticamente inútiles, o simplemente son erróneas porque el reloj del servidor remoto está desfasado.
- El campo*`stat`* puede tener otros valores que los definidos en el Apéndice B. Use el sentido común y la documentación del socio SMSC para entender su significado.
- El campo*`err`* depende completamente del SMS-C, y la mayoría de las veces el socio SMS-C lo ha documentado. A menudo, el código 000 significa un éxito, mientras que cualquier otro código indica errores. El campo suele ser numérico, pero también puede ser hexadecimal.

<br><br><br><br><br><br>Múltiples SR para la misma MT<br><br><br><br><br><br>
Algunos SMS-C envían múltiples SR para la misma MT para seguir la progresión de la MT en la red. Esto es generalmente inútil porque la mayoría de las veces el cliente solo quiere saber cuándo se recibió el mensaje (esto suele ser el último SR).

En caso de duda, solo trabaje con el último SR recibido del SMS-C para encontrar el estado de un mensaje.
<br><br><br><br><br><br>Ventana SMPP<br><br><br><br><br><br>
Dado que las operaciones y las respuestas son asíncronas, puede optimizar la velocidad de transferencia si envía varias PDU de operación antes de esperar las respuestas. El número de mensajes que no tienen respuesta se llama ventana.

Ejemplo de una transmisión con una ventana máxima de 4:
![smpp10](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_2072040949/smpp10.png "smpp10")
La implementación actual no controla la ventana y espera que el SMS-C remoto sea lo bastante rápido para gestionar la MT.
