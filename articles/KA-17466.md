---
title: "AEM 6.x | Consejos de ajuste del rendimiento"
description: Descripción
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager 6.4,Experience Manager 6.5"
keywords: “KCS”
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "10/20/2021 8:01:31 PM"
article-published-by: Victoria Barnato
article-published-date: "4/20/2023 8:08:11 PM"
version-number: 1
article-number: KA-17466
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ec237884-e031-ec11-b6e5-000d3a5ba97a"
source-git-commit: e6798bd73d1fd57206d44cb063994c6a1e276e05
workflow-type: tm+mt
source-wordcount: '1971'
ht-degree: 1%

---

# AEM 6.x | Consejos de ajuste del rendimiento

## Descripción {#description}


El tiempo de respuesta es deficiente cuando los autores editan contenido o los sitios web responden lentamente a las solicitudes de los visitantes.


<br><br><br><br>Causa<br><br><br><br><br><br>
Los siguientes factores influyen en los problemas de rendimiento en AEM:

- Diseño incorrecto
- Código de aplicación
- Falta de almacenamiento en caché
- Configuración de E/S de disco incorrecta
- Tamaño de la memoria
- Ancho de banda y latencia de la red
- AEM instalado en algunas versiones selectas de windows 2008 y 2012 donde la gestión de memoria es un problema
- Modificar las configuraciones integradas como se describe a continuación puede ayudar a mejorar el rendimiento en AEM.



## Resolución {#resolution}

<br><br>Prevención de problemas de rendimiento<br><br><br><br> <br><br>
A continuación se indican algunos pasos que puede seguir para asegurarse de encontrar y corregir problemas de rendimiento antes de que afecten a sus usuarios:

- Implemente y ejecute pruebas de carga que simulen escenarios realistas tanto en instancias de autor como de publicación. Investigar y definir la carga esperada es un paso crucial en este proceso. Este paso le ayuda a demostrar si la aplicación AEM, la arquitectura y la instalación AEM funcionarán bien una vez que se encuentren en un entorno de producción.
Los resultados de este ejercicio ayudan a determinar si hay un problema de configuración errónea, de aplicación, de tamaño, de hardware u otro que afecte al rendimiento del sistema. Consulte también la [directrices de rendimiento](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/performance-guidelines.html?lang=en) y [directrices de monitorización](https://helpx.adobe.com/experience-manager/kb/how-to-monitor-the-tarmk.html)


- Además de las pruebas de carga, las pruebas de estrés ayudan a definir la carga máxima que puede soportar el sistema. Esta prueba puede ayudarle a prepararse para los picos de tráfico. Encontrará más información sobre las pruebas de rendimiento [here](https://experienceleague.adobe.com/docs/experience-manager-64/deploying/practices/best-practices.html).


- Instale los service packs AEM recomendados, los paquetes fijos acumulativos y las revisiones: [Actualizaciones de las versiones de Adobe Experience Manager](https://experienceleague.adobe.com/docs/experience-manager-release-information/aem-release-updates/aem-releases-updates.html?lang=es)


- Si está usando un servidor de Windows, revise [este artículo](https://helpx.adobe.com/experience-manager/kb/high-memory-usage-aem-6.html).


- Si planea cargar grandes cantidades de recursos (imágenes, vídeos, etc.) en AEM, asegúrese de aplicar la variable [Prácticas recomendadas de recursos](https://experienceleague.adobe.com/docs/experience-manager-65/assets/best-practices-for-assets.html?lang=en).


- Aprovisionar suficiente RAM y evitar la saturación de IO
   <br>     Si desea ejecutar la producción a cualquier escala, el entorno Linux debe estar aprovisionado con tanta RAM como los archivos tar del segmento crecerán entre la compactación sin conexión (o los picos de compactación en línea).  Además, lo siguiente evitará la saturación de E/S.

   - Discos de sistema operativo/datos/registro separados


   - Montar discos de datos con noatime


   - establezca los búferes readforward en 32 en el disco de datos.


   - Lo ideal es utilizar xfs sobre ext4 en los discos de datos.


   - Si RedHat se ejecuta en una VM, asegúrese de que el grupo de entropía sea siempre de 1K bits (utilice rngtools si es necesario).


- Desactivar Transparent Huge Pages en Linux
   <br>     AEM realiza lecturas/escrituras específicas, mientras que Linux Transparent Huge Pages está optimizado para operaciones grandes, por lo que se recomienda [desactivar páginas grandes transparentes](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/introduction/aem-with-mongodb.html?lang=en#operating-system-support) cuando se utiliza Mongo o Tar storage.



<br><br><br><br> <br><br>Activación de flujos de trabajo transitorios<br><br><br><br> <br><br>
Los flujos de trabajo transitorios se pueden utilizar para cualquier flujo de trabajo que:

- se ejecutan a menudo.
- no necesitan el historial del flujo de trabajo.


Generarán un aumento del rendimiento en esas situaciones.

Este caso de uso suele cumplirse cuando hay grandes volúmenes de consumo de recursos.

Siga el procedimiento documentado en [Recursos de ajuste de rendimiento](https://experienceleague.adobe.com/docs/experience-manager-65/assets/administer/performance-tuning-guidelines.html?lang=en)
<br><br><br><br> <br><br>Ajuste de las colas de trabajos de Sling<br><br><br><br> <br><br>
La carga masiva de recursos de gran tamaño suele ser un proceso que consume muchos recursos. De forma predeterminada, el número de subprocesos simultáneos por cola de trabajos es igual al número de núcleos de CPU. Como tal, esta configuración de valor puede causar un impacto general en el rendimiento y un alto consumo de memoria Java.
<br>Adobe recomienda que no supere el 50% de los núcleos de CPU. Para ajustar este valor, vaya a lo siguiente: http:/host:port/system/console/configMgr/org.apache.sling.event.jobs.QueueConfiguration<br><br>


Establezca <b>queue.maxparallel</b> a un valor que representa el 50% de los núcleos de CPU del servidor que aloja su instancia de AEM. Por ejemplo, para 8 núcleos de CPU, establezca el valor en 4.
<br><br><br><br> <br><br>Ajuste del repositorio Oak<br><br><br><br> <br><br>
Primero asegúrese de tener la última versión de Oak instalada para su instancia de AEM 6. Compruebe la página de revisiones recomendadas mencionada anteriormente.
 <br><br>Optimizaciones del motor de consulta/índice Oak
- <b>Cree índices personalizados de oak para todas las consultas de búsqueda usadas con frecuencia.</b>

   - Para obtener información sobre cómo analizar consultas lentas, consulte esta [article](https://experienceleague.adobe.com/docs/experience-manager-65/developing/bestpractices/troubleshooting-slow-queries.html?lang=en).
   - Cree los índices personalizados en el nodo oak:index para todas las propiedades de búsqueda con las que desee buscar. Para ello, siga este procedimiento [article](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17492.html?lang=es).
   - Para cada índice personalizado basado en Lucene, intente establecer la configuración includedPaths (String) para restringir que el índice solo se aplique a ciertas rutas de contenido. A continuación, restrinja las búsquedas aplicables a las rutas que incluye el índice.


- <b>Parámetros de JVM</b>
Añada estos parámetros de JVM en el script de inicio de AEM para evitar que las consultas expansivas sobrecarguen los sistemas. Tenga en cuenta que estos son valores predeterminados a partir de AEM 6.3.

   - -Doak.queryLimitInMemory=500000 (ver también [Documentación de Oak](http://jackrabbit.apache.org/oak/docs/query/query-engine.html#Slow_Queries_and_Read_Limits))
   - -Doak.queryLimitReads=100000 (ver también [Documentación de Oak](http://jackrabbit.apache.org/oak/docs/query/query-engine.html#Slow_Queries_and_Read_Limits))
   - -Dupdate.limit=250000 (solo para DocumentNodeStore, p. ej. MongoMK, RDBMK)

   La siguiente opción *may* también mejora el rendimiento, pero cambia el significado de la llamada de tamaño del resultado. Especialmente, solo se tienen en cuenta las restricciones de consulta que forman parte del índice utilizado al calcular el tamaño.
Además, las ACL no se aplican a los resultados, por lo que los nodos que no son visibles para la sesión actual se incluirán en el recuento devuelto. Como tal, el recuento devuelto puede ser mayor que el número real de resultados y el recuento preciso solo puede determinarse mediante la iteración a través de los resultados:

   - -Doak.fastQuerySize=true (consulte también Tamaño de los resultados en [Documentación de Oak](http://jackrabbit.apache.org/oak/docs/query/query-engine.html))

   Precaución: Habilitación <b>fastQuerySize</b> da como resultado respuestas de consulta más rápidas. Sin embargo, AEM devuelve recuentos de resultados inexactos para algunas consultas. Si se basa en recuentos de resultados precisos en su aplicación, no utilice <b>fastQuerySize</b>.


- <b>Configuración del índice Lucene</b>
Abra /system/console/configMgr/org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexProviderService y

   - enable <b>CopyOnRead (habilitado de forma predeterminada desde AEM 6.2)</b>
   - enable <b>CopyOnWrite (habilitado de forma predeterminada desde AEM 6.2)</b>
   - enable <b>Recuperar previamente archivos de índice (habilitado de forma predeterminada desde AEM 6.2)</b>

   Consulte [http://jackrabbit.apache.org/oak/docs/query/lucene.html](http://jackrabbit.apache.org/oak/docs/query/lucene.html) para obtener más información acerca de los parámetros disponibles Debido a que algunas rutas no necesitan ser indexadas, puede hacer lo siguiente: En CRXDE Lite, vaya a /oak:index/lucene, establezca una propiedad de cadena multivalor (String) denominada excludedPaths con estos valores /var, /etc/workflow/instances, /etc/replication.


- <b>Almacén de datos</b>
Si utiliza AEM Assets o tiene una aplicación AEM que utiliza archivos binarios de forma extensiva, Adobe recomienda utilizar un almacén de datos externo. El uso de un almacén de datos externo ayuda a garantizar el máximo rendimiento.  Consulte [documentación para instrucciones detalladas](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/deploying/data-store-config.html?lang=en).
Cuando utilice un FileDataStore, ajuste cacheSizeInMB a un porcentaje de su pila disponible. Un valor conservador es el 2% de la pila máxima.  Por ejemplo, para una pila de 8 GB: maxCachedBinarySize=1048576

   cacheSizeInMB=164 Tenga en cuenta que maxCachedBinarySize está establecido en 1 MB (1048576). Como tal, solo almacena en caché archivos que tengan un máximo de 1 MB.  También puede tener sentido ajustar esta configuración a un valor más pequeño.
Cuando se trata de un gran número de binarios, se desea maximizar el rendimiento. Por lo tanto, Adobe recomienda utilizar un almacén de datos externo en lugar de los almacenes de nodos predeterminados. Además, Adobe recomienda ajustar los siguientes parámetros:

   - maxCachedBinarySize=10485760
   - cacheSizeInMB=4096




Nota:

La variable <b>cacheSizeInMB</b> puede causar que el proceso Java se quede sin memoria si está configurado a un valor demasiado alto. Por ejemplo, si tiene el tamaño máximo de pila establecido en 8 GB (-Xmx8g) y espera que AEM y su aplicación utilicen una pila combinada de 4 GB, entonces tiene sentido configurar <b>cacheSizeInMB</b> a 82 en lugar de 164. En el rango del 2-10% de la pila máxima es una configuración segura. Sin embargo, Adobe recomienda que valide los cambios de configuración con pruebas de carga mientras también supervisa la utilización de la memoria.
 <br><br>Ajuste del almacenamiento de Mongo
- <b>Tamaño de caché de MongoBlobStore</b>:  El blobstore se utiliza para almacenar y leer objetos binarios grandes. Internamente, se implementa el almacén con caché que divide los binarios en bloques relativamente pequeños (datos, código hash o hash indirecto), de modo que cada bloque quepa en la memoria.
En una configuración predeterminada, MongoBlobStore utiliza un tamaño de caché fijo de 16 MB.  Para implementaciones en las que hay más RAM disponible y se accede con frecuencia al almacenamiento en blob (por ejemplo, cuando el índice Lucene es grande), aumente el tamaño de la caché. Este tamaño de caché solo se aplica cuando se utiliza MongoBlobStore (predeterminado), no cuando se utiliza un blobstore externo.

   - Puede configurar el tamaño de caché (en MB) mediante la configuración de blobCacheSize en [DocumentNodeStoreService](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/deploying/data-store-config.html?lang=en).

      Por ejemplo: blobCacheSize=1024
   - Consulte también AEM-MongoDB [lista de comprobación](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/introduction/aem-with-mongodb.html?lang=en).


- <b>Tamaño de la caché del documento</b>: Para optimizar el rendimiento de los nodos de lectura de MongoDB, es necesario ajustar los tamaños de las cachés de DocumentNodeStore.  El tamaño predeterminado de la caché se establece en 256 MB, que se distribuye entre varias cachés utilizadas en DocumentNodeStore. Consulte [http://jackrabbit.apache.org/oak/docs/nodestore/documentmk.html#cache](http://jackrabbit.apache.org/oak/docs/nodestore/documentmk.html#cache)

   - Puede configurar el tamaño de caché (MB) mediante la configuración de caché en DocumentNodeStoreService. Por ejemplo, cache=2048.
   - Establezca todas las siguientes configuraciones de caché en crx-quickstart/install/org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreService.configand luego cargue la prueba con varios valores para ver cuál es la configuración óptima para su entorno. Tenga en cuenta que el porcentaje de caché restante se asigna a la caché del documento:
      - cache=2048
      - nodeCachePercentage=35
      - childrenCachePercentage=20
      - diffCachePercentage=30
      - docChildrenCachePercentage=10
   - Con la configuración anterior, los porcentajes totales son del 95 %.  El 5% restante de la caché se asigna a documentCache.

        documentCache = cache - nodeCache - childrenCache - diffCache - docChildrenCache
   - Al distribuir los porcentajes de caché, asegúrese de que la caché que queda para documentCache no sea muy grande. Es decir, manténgalo a un máximo de 500 MB o menos; un documentCache grande puede provocar un aumento en el tiempo necesario para realizar la invalidación de la caché.


- <b>Configuración de caché en AEM 6.2 con Oak 1.4.x:</b>

   - En AEM 6.2, se han realizado cambios en la forma en que funcionan estos ajustes de caché. En AEM 6.2 con Oak 1.4, hay una nueva caché: prevDocCache.  Puede configurar esta caché utilizando la configuración prevDocCachePercentage. El valor predeterminado es 4.
   - documentCache utiliza el MB de caché restante (configuración de caché menos el tamaño de todas las demás cachés):

        documentCache = cache - nodeCache - childrenCache - diffCache - docChildrenCache - prevDocCache


- <b>Implementar la lista de comprobación de producción de MongoDB</b>

   [http://docs.mongodb.org/manual/administration/production-checklist/](http://docs.mongodb.org/manual/administration/production-checklist/) - según el soporte de Mongo DB, muchos de los elementos tienen un gran impacto en el rendimiento. Para cualquier pregunta, póngase en contacto directamente con el soporte técnico de MongoDB.


- <b>Leer rendimiento</b>: Añada este parámetro de cadena de consulta a la URL de su base de datos de Mongo en cada nodo de AEM:  ?<b>readPreference=childPreferred</b>

   Este parámetro le indica al sistema que haga lecturas del secundario, lo que le proporciona un mayor rendimiento de lectura.


- <b>Aumento del grupo de subprocesos para la observación de roak</b>: open <b>/system/console/configMgr/org.apache.sling.commons.threads.impl.DefaultThreadPool.factory</b>

   Establezca el nombre en oak-observation y establezca el tamaño mínimo y máximo del grupo en 20.


- <b>Aumentar la longitud de la cola de observación</b>: Crear un archivo con el nombre <b>com.adobe.granite.repository.impl.SlingRepositoryManager.cfg</b> que contiene el parámetro <b>oak.observation.queue-length=50000 </b>. Colóquelo debajo de la <b>/crx-quickstart/install</b> carpeta.


- <b>Evitar consultas de larga duración</b>: Establezca la propiedad del sistema en la JVM <b>parámetros: -Doak.mongo.maxQueryTimeMS=60000</b> para evitar que las consultas se ejecuten durante más de 1 minuto.



<br><br><br><br> <br><br>Ajuste del almacenamiento de tar<br><br><br><br> <br><br>
Los microkernels no llaman directamente a archivos asignados a memoria. Sin embargo, JDK utiliza internamente archivos asignados a memoria para una lectura eficiente. En algunos sistemas operativos Windows de 64 bits, es posible que no se puedan limpiar los archivos asignados a la memoria y consumir toda la memoria del sistema operativo nativo. Asegúrese de instalar los parches/correcciones relacionados con el rendimiento de microsoft (consulte [KB 2731284](https://support.microsoft.com/en-us/topic/-33-dos-error-code-when-memory-memory-mapped-files-are-cleaned-by-using-the-flushviewoffile-function-in-windows-7-or-in-windows-server-2008-r2-79fd0431-2898-d6a0-d182-e260e1fc1104)) y Oracle.

- Una opción alternativa es deshabilitar el modo de asignación de memoria añadiendo <b>tarmk.mode=32</b> en [SegmentNodeStoreService.config](https://helpx.adobe.com/experience-manager/6-4/sites/deploying/using/data-store-config.html#NodeStoreConfigurations) hasta que se resuelva el problema del sistema operativo. El inconveniente de la desactivación hace que la E/S sea intensiva. Asegúrese de aumentar el límite de bloqueo de página de E/S.

<br><br><br><br> <br><br>Limpieza de revisión de TarMK (compactación)<br><br><br><br><br><br>


A partir de AEM 6.3, la compactación en línea (también conocida como limpieza de revisión en línea) estará activada de forma predeterminada. Consulte [esta página](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/deploying/revision-cleanup.html?lang=en) para obtener más información.
<br><br><br><br> <br><br>Cloud Manager para clientes de Adobe Managed Services (AMS)<br><br><br><br> <br><br>
[Cloud Manager](https://docs.adobe.com/content/help/es-ES/experience-manager-cloud-manager/using/introduction-to-cloud-manager.html) (Solo clientes de AMS) permite a los clientes garantizar una implementación AEM correcta con pruebas de rendimiento guiadas y escalado automático.
